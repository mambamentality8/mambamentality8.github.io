# Spring Security Oauth2 JWT

### 用户认证需求分析

#### 用户认证与授权

​	截至目前，项目已经完成了在线学习功能，用户通过在线学习页面点播视频进行学习。如何去记录学生的学习过程呢？要想掌握学生的学习情况就需要知道用户的身份信息，记录哪个用户在什么时间学习什么课程；如果用户要购买课程也需要知道用户的身份信息。所以，去管理学生的学习过程最基本的要实现用户的身份认证。

什么是用户身份认证？

​	用户身份认证即用户去访问系统资源时系统要求验证用户的身份信息，身份合法方可继续访问。常见的用户身份认证表现形式有：用户名密码登录，指纹打卡等方式。

什么是用户授权？

​	用户认证通过后去访问系统的资源，系统会判断用户是否拥有访问资源的权限，只允许访问有权限的系统资源，没有权限的资源将无法访问，这个过程叫用户授权。

#### 单点登录需求

​	本项目包括多个子项目，如：学习系统，教学管理中心、系统管理中心等，为了提高用户体验性需要实现用户只认证一次便可以在多个拥有访问权限的系统中访问，这个功能叫做单点登录。

引用百度百科：单点登录（Single Sign On），简称为 SSO，是目前比较流行的企业业务整合的解决方案之一。SSO的定义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。

下图是SSO的示意图，用户登录学成网一次即可访问多个系统。

![1526567995945](file:///E:/%E4%BC%A0%E6%99%BA%E5%B7%A5%E4%BD%9C/%E5%A4%87%E8%AF%BE%E8%B5%84%E6%96%99/JavaEE%E5%9C%A8%E7%BA%BF%E5%B0%B1%E4%B8%9A%E7%8F%AD%E8%AF%BE%E7%A8%8B%E8%B5%84%E6%96%99/7.%E9%98%B6%E6%AE%B5%E4%B8%83-%E5%BE%AE%E6%9C%8D%E5%8A%A1-%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/01-HTML%E7%89%88%E6%9C%AC%E8%AE%B2%E4%B9%89(%E8%AF%B7%E4%BD%BF%E7%94%A8HTML%E7%89%88%E6%9C%AC%E8%AE%B2%E4%B9%89%E5%AD%A6%E4%B9%A0)/HTML%E7%89%88%E6%9C%AC/day16%20Spring%20Security%20Oauth2/images/1526567995945.png)

#### 第三方认证需求

​	作为互联网项目难免需要访问外部系统的资源，同样本系统也要访问第三方系统的资源接口，一个场景如下：

​	一个微信用户没有在学成在线注册，本系统可以通过请求微信系统来验证该用户的身份，验证通过后该用户便可在本系统学习，它的基本流程如下：

![1526542127637](file:///E:/%E4%BC%A0%E6%99%BA%E5%B7%A5%E4%BD%9C/%E5%A4%87%E8%AF%BE%E8%B5%84%E6%96%99/JavaEE%E5%9C%A8%E7%BA%BF%E5%B0%B1%E4%B8%9A%E7%8F%AD%E8%AF%BE%E7%A8%8B%E8%B5%84%E6%96%99/7.%E9%98%B6%E6%AE%B5%E4%B8%83-%E5%BE%AE%E6%9C%8D%E5%8A%A1-%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/01-HTML%E7%89%88%E6%9C%AC%E8%AE%B2%E4%B9%89(%E8%AF%B7%E4%BD%BF%E7%94%A8HTML%E7%89%88%E6%9C%AC%E8%AE%B2%E4%B9%89%E5%AD%A6%E4%B9%A0)/HTML%E7%89%88%E6%9C%AC/day16%20Spring%20Security%20Oauth2/images/1526542127637.png)

​	从上图可以看出，微信不属于本系统，本系统并没有存储微信用户的账号、密码等信息，本系统如果要获取该用户的基本信息则需要首先通过微信的认证系统（微信认证）进行认证，微信认证通过后本系统便可获取该微信用户的基本信息，从而在本系统将该微信用户的头像、昵称等信息显示出来，该用户便不用在本系统注册却可以直接学习。

什么是第三方认证（跨平台认证）？

当需要访问第三方系统的资源时需要首先通过第三方系统的认证（例如：微信认证），由第三方系统对用户认证通过，并授权资源的访问权限。

![1526570610376](file:///E:/%E4%BC%A0%E6%99%BA%E5%B7%A5%E4%BD%9C/%E5%A4%87%E8%AF%BE%E8%B5%84%E6%96%99/JavaEE%E5%9C%A8%E7%BA%BF%E5%B0%B1%E4%B8%9A%E7%8F%AD%E8%AF%BE%E7%A8%8B%E8%B5%84%E6%96%99/7.%E9%98%B6%E6%AE%B5%E4%B8%83-%E5%BE%AE%E6%9C%8D%E5%8A%A1-%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/01-HTML%E7%89%88%E6%9C%AC%E8%AE%B2%E4%B9%89(%E8%AF%B7%E4%BD%BF%E7%94%A8HTML%E7%89%88%E6%9C%AC%E8%AE%B2%E4%B9%89%E5%AD%A6%E4%B9%A0)/HTML%E7%89%88%E6%9C%AC/day16%20Spring%20Security%20Oauth2/images/1526570610376.png)

### 用户认证技术方案

#### 单点登录技术方案

分布式系统要实现单点登录，通常将认证系统独立抽取出来，并且将用户身份信息存储在单独的存储介质，比如：MySQL、Redis，考虑性能要求，通常存储在Redis中，如下图：

![1526569358642](file:///E:/%E4%BC%A0%E6%99%BA%E5%B7%A5%E4%BD%9C/%E5%A4%87%E8%AF%BE%E8%B5%84%E6%96%99/JavaEE%E5%9C%A8%E7%BA%BF%E5%B0%B1%E4%B8%9A%E7%8F%AD%E8%AF%BE%E7%A8%8B%E8%B5%84%E6%96%99/7.%E9%98%B6%E6%AE%B5%E4%B8%83-%E5%BE%AE%E6%9C%8D%E5%8A%A1-%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/01-HTML%E7%89%88%E6%9C%AC%E8%AE%B2%E4%B9%89(%E8%AF%B7%E4%BD%BF%E7%94%A8HTML%E7%89%88%E6%9C%AC%E8%AE%B2%E4%B9%89%E5%AD%A6%E4%B9%A0)/HTML%E7%89%88%E6%9C%AC/day16%20Spring%20Security%20Oauth2/images/1526569358642.png)

单点登录的特点是：

1、认证系统为独立的系统。

2、各子系统通过Http或其它协议与认证系统通信，完成用户认证。

3、用户身份信息存储在Redis集群。

 

Java中有很多用户认证的框架都可以实现单点登录：

1、Apache Shiro.

2、CAS

3、Spring security CAS

#### Oauth2认证

