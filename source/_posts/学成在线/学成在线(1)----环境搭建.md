

# WebStorm安装

下载地址 
https://www.jetbrains.com/webstorm/download/previous.html 

选择  2018.2.3版本

![1568795246384](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/01.png)

一路下一步



破解码

```
K6IXATEF43-eyJsaWNlbnNlSWQiOiJLNklYQVRFRjQzIiwibGljZW5zZWVOYW1lIjoi5o6I5p2D5Luj55CG5ZWGOiBodHRwOi8vaWRlYS5oay5jbiIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IklJIiwiZmFsbGJhY2tEYXRlIjoiMjAxOS0wNi0wNSIsInBhaWRVcFRvIjoiMjAyMC0wNi0wNCJ9LHsiY29kZSI6IkFDIiwiZmFsbGJhY2tEYXRlIjoiMjAxOS0wNi0wNSIsInBhaWRVcFRvIjoiMjAyMC0wNi0wNCJ9LHsiY29kZSI6IkRQTiIsImZhbGxiYWNrRGF0ZSI6IjIwMTktMDYtMDUiLCJwYWlkVXBUbyI6IjIwMjAtMDYtMDQifSx7ImNvZGUiOiJQUyIsImZhbGxiYWNrRGF0ZSI6IjIwMTktMDYtMDUiLCJwYWlkVXBUbyI6IjIwMjAtMDYtMDQifSx7ImNvZGUiOiJHTyIsImZhbGxiYWNrRGF0ZSI6IjIwMTktMDYtMDUiLCJwYWlkVXBUbyI6IjIwMjAtMDYtMDQifSx7ImNvZGUiOiJETSIsImZhbGxiYWNrRGF0ZSI6IjIwMTktMDYtMDUiLCJwYWlkVXBUbyI6IjIwMjAtMDYtMDQifSx7ImNvZGUiOiJDTCIsImZhbGxiYWNrRGF0ZSI6IjIwMTktMDYtMDUiLCJwYWlkVXBUbyI6IjIwMjAtMDYtMDQifSx7ImNvZGUiOiJSUzAiLCJmYWxsYmFja0RhdGUiOiIyMDE5LTA2LTA1IiwicGFpZFVwVG8iOiIyMDIwLTA2LTA0In0seyJjb2RlIjoiUkMiLCJmYWxsYmFja0RhdGUiOiIyMDE5LTA2LTA1IiwicGFpZFVwVG8iOiIyMDIwLTA2LTA0In0seyJjb2RlIjoiUkQiLCJmYWxsYmFja0RhdGUiOiIyMDE5LTA2LTA1IiwicGFpZFVwVG8iOiIyMDIwLTA2LTA0In0seyJjb2RlIjoiUEMiLCJmYWxsYmFja0RhdGUiOiIyMDE5LTA2LTA1IiwicGFpZFVwVG8iOiIyMDIwLTA2LTA0In0seyJjb2RlIjoiUk0iLCJmYWxsYmFja0RhdGUiOiIyMDE5LTA2LTA1IiwicGFpZFVwVG8iOiIyMDIwLTA2LTA0In0seyJjb2RlIjoiV1MiLCJmYWxsYmFja0RhdGUiOiIyMDE5LTA2LTA1IiwicGFpZFVwVG8iOiIyMDIwLTA2LTA0In0seyJjb2RlIjoiREIiLCJmYWxsYmFja0RhdGUiOiIyMDE5LTA2LTA1IiwicGFpZFVwVG8iOiIyMDIwLTA2LTA0In0seyJjb2RlIjoiREMiLCJmYWxsYmFja0RhdGUiOiIyMDE5LTA2LTA1IiwicGFpZFVwVG8iOiIyMDIwLTA2LTA0In0seyJjb2RlIjoiUlNVIiwiZmFsbGJhY2tEYXRlIjoiMjAxOS0wNi0wNSIsInBhaWRVcFRvIjoiMjAyMC0wNi0wNCJ9XSwiaGFzaCI6IjEzMjkyMzI4LzAiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0=-KUaQi549fH96M/qU7jTvuMeq2GuedA+WppV3irI0JHlfDuhJlidK2m3yoRxitGNmimPFVUA8Dk38OzXnP29I39QDXH5VAF8VjOP0XrqdfrpaZUKpdhRaYz8r1NAwID75U4LqYCvFbazka1dCMJBFqJ2wum1+CSQhJ1O7CSchAJAbjcCRQjbU2sXOofAA2sPLi7nlJw2wrjOHzH9cOczUn11n24PE9BQ/oYGITHkzsu94i4Q90Z1jQysMtXLgM/HoLSHY2T9rKULLoh+tdMwBp9+m0VLF/R5gdkVDV/dlorrA9OEZIsSOaG+oWSen/AulKH6OXllZJoR+b/T6YYfGWg==-MIIElTCCAn2gAwIBAgIBCTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTE4MTEwMTEyMjk0NloXDTIwMTEwMjEyMjk0NlowaDELMAkGA1UEBhMCQ1oxDjAMBgNVBAgMBU51c2xlMQ8wDQYDVQQHDAZQcmFndWUxGTAXBgNVBAoMEEpldEJyYWlucyBzLnIuby4xHTAbBgNVBAMMFHByb2QzeS1mcm9tLTIwMTgxMTAxMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAxcQkq+zdxlR2mmRYBPzGbUNdMN6OaXiXzxIWtMEkrJMO/5oUfQJbLLuMSMK0QHFmaI37WShyxZcfRCidwXjot4zmNBKnlyHodDij/78TmVqFl8nOeD5+07B8VEaIu7c3E1N+e1doC6wht4I4+IEmtsPAdoaj5WCQVQbrI8KeT8M9VcBIWX7fD0fhexfg3ZRt0xqwMcXGNp3DdJHiO0rCdU+Itv7EmtnSVq9jBG1usMSFvMowR25mju2JcPFp1+I4ZI+FqgR8gyG8oiNDyNEoAbsR3lOpI7grUYSvkB/xVy/VoklPCK2h0f0GJxFjnye8NT1PAywoyl7RmiAVRE/EKwIDAQABo4GZMIGWMAkGA1UdEwQCMAAwHQYDVR0OBBYEFGEpG9oZGcfLMGNBkY7SgHiMGgTcMEgGA1UdIwRBMD+AFKOetkhnQhI2Qb1t4Lm0oFKLl/GzoRykGjAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBggkA0myxg7KDeeEwEwYDVR0lBAwwCgYIKwYBBQUHAwEwCwYDVR0PBAQDAgWgMA0GCSqGSIb3DQEBCwUAA4ICAQAF8uc+YJOHHwOFcPzmbjcxNDuGoOUIP+2h1R75Lecswb7ru2LWWSUMtXVKQzChLNPn/72W0k+oI056tgiwuG7M49LXp4zQVlQnFmWU1wwGvVhq5R63Rpjx1zjGUhcXgayu7+9zMUW596Lbomsg8qVve6euqsrFicYkIIuUu4zYPndJwfe0YkS5nY72SHnNdbPhEnN8wcB2Kz+OIG0lih3yz5EqFhld03bGp222ZQCIghCTVL6QBNadGsiN/lWLl4JdR3lJkZzlpFdiHijoVRdWeSWqM4y0t23c92HXKrgppoSV18XMxrWVdoSM3nuMHwxGhFyde05OdDtLpCv+jlWf5REAHHA201pAU6bJSZINyHDUTB+Beo28rRXSwSh3OUIvYwKNVeoBY+KwOJ7WnuTCUq1meE6GkKc4D/cXmgpOyW/1SmBz3XjVIi/zprZ0zf3qH5mkphtg6ksjKgKjmx1cXfZAAX6wcDBNaCL+Ortep1Dh8xDUbqbBVNBL4jbiL3i3xsfNiyJgaZ5sX7i8tmStEpLbPwvHcByuf59qJhV/bZOl8KqJBETCDJcY6O2aqhTUy+9x93ThKs1GKrRPePrWPluud7ttlgtRveit/pcBrnQcXOl1rHq7ByB8CFAxNotRUYL9IF5n3wJOgkPojMy6jetQA5Ogc8Sm7RG6vg1yow==
```

​	![1568795323981](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/02.png)

# nginx安装

下载nginx：http://nginx.org/en/download.html 
本教程下载nginx-1.14.0.zip(http://nginx.org/download/nginx-1.14.0.zip) 解压nginx-1.14.0.zip到自己的计算机，双击nginx.exe即可运行。
访问 ：http://localhost

![1568797250228](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/03.png)

nginx启动和停止

```
启动

直接点击Nginx目录下的nginx.exe    或者    Nginx目录下cmd运行start nginx

关闭

Nginx目录下 nginx -s stop    或者    Nginx目录下 nginx -s quit

stop表示立即停止nginx,不保存相关信息

quit表示正常退出nginx,并保存相关信息

重启(因为改变了配置,需要重启)

nginx -s reload
```



# nginx配置

配置虚拟主机

```
server{
	listen       80;
	server_name  www.xuecheng.com;
	ssi on;
	ssi_silent_errors on;
	location / {
		alias   X:/workspace/java/xczx/xczx01/xc-ui-pc-static-portal/;
		index  index.html;
	}
	
   }
```

配置完以后要reload   nginx



配置hosts文件
以管理员身份修改C:\Windows\System32\drivers\etc\hosts文件

```
127.0.0.1 www.xuecheng.com
```

进入浏览器，输入http://www.xuecheng.com  

![1568799244482](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/04.png)



# SSI服务端包含技术

- 页面内容多如何管理？ 
  将页面拆分成一个一个的小页面，通过cms去管理这些小页面，当要更改部分页面内容时只需要更改具体某个小页 面即可。
- 页面拆出来怎么样通过web服务浏览呢？ 
  使用web服务(例如nginx)的SSI技术，将多个子页面合并渲染输出。 
- SSI是什么？

![1568799726999](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/05.png)

​	ssi包含类似于jsp页面中的incluce指令，ssi是在web服务端将include指定 的页面包含在网页中，渲染html网页响 应给客户端 。nginx、apache等多数web容器都支持SSI指令。
ssi指令如下：

```
<!‐‐#include virtual="/../....html"‐‐>
```



- 将首页拆分成

  ```
  index.html：首页主体内容 
  include/header.html：头部区域 
  include/index_banner.html：轮播图 
  include/index_category.html：左侧列表导航 include/footer.html：页尾
  ```

- 在nginx虚拟主机中开通SSI

  ```
  server{
      listen       80;     server_name  www.xuecheng.com;     
      ssi on;
      ssi_silent_errors on;     
      ......
  ```

  ssi的配置参数如下： 

  ssi on： 开启ssi支持 ssi_silent_errors on：默认为oﬀ，设置为on则在处理SSI文件出错时不 输出错误信息 ssi_types：默认为 ssi_types text/html，如果需要支持shtml（服务器执行脚本，类似于jsp）则需 要设置为ssi_types text/shtml

- 测试 

  导入门户工程
  使用WebStorm打开门户工程目录，目录的结构如下，后期会根据开发的推进进行扩充。

  ![1568797279338](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/06.png)

  去掉某个#include查看页面效果。

# CMS页面管理需求

### 这些页面的管理流程是什么?

1）创建站点： 
一个网站有很多子站点，比如：学成在线有主门户、学习中心、问答系统等子站点。具体的哪个页面是归属于具体 的站点，所以要管理页面，先要管理页面所属的站点。
2）创建模板： 
页面如何创建呢？比如电商网站的商品详情页面，每个页面的内容布局、板式是相同的，不同的只是内容，这个页 面的布局、板式就是页面模板，模板+数据就组成一个完整的页面，最终要创建一个页面文件需要先定义此页面的 模板，最终拿到页面的数据再结合模板就拼装成一个完整的页面。

3）创建页面：
创建页面是指填写页面的基本信息，如：页面的名称、页面的url地址等。
4）页面预览： 
页面预览是页面发布前的一项工作，页面预览使用静态化技术根据页面模板和数据生成页面内容，并通过浏览器预 览页面。页面发布前进行页面预览的目是为了保证页面发布后的正确性。
5）页面发布：
  使用计算机技术将页面发送到页面所在站点的服务器，页面发布成功就可以通过浏览器来访问了。 
2、本项目要实现什么样的功能？
1）页面管理
管理员在后台添加、修改、删除页面信息
2）页面预览
管理员通过页面预览功能预览页面发布后的效果。
3）页面发布
管理员通过页面发布功能将页面发布到远程门户服务器。 
页面发布成功，用户即可在浏览器浏览到最新发布的页面，整个页面添加、发布的过程由于软件自动执行，无需人 工登录服务器操作。

# CMS服务端工程搭建

### 开发工具配置:

- 创建工程代码目录 XcEduCode

- 配置maven环境 ,maven仓库的目录位置不要去使用中文

- 设置编码

  ![1568820442695](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/07.png)

- 配置JDK1.8 

  ![1568820813638](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/08.png)

- 自动优化导入包

  ![1568820841956](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/09.png)

- 自定义自己的代码模板

  ![1568820864830](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/10.png)

- 提示忽略大小写

  ![1568820883255](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/11.png)

- 配置虚拟机内存,修改idea64.exe.vmoptions

  ```
  一个例子，电脑内存8G，设置如下：
  -Xms1024m -Xmx4096m -XX:MaxPermSize=1024m -XX:ReservedCodeCacheSize=1024m
  ```

### 导入基础工程

CMS及其它服务端工程基于maven进行构建，首先需要创建如下基础工程： 

- parent工程：父工程，提供依赖管理。 
- common工程：通用工程，提供各层封装
- model工程：模型工程，提供统一的模型类管理 
- utils工程：工具类工程，提供本项目所使用的工具类 
-  Api工程：接口工程，统一管理本项目的服务接口。



依次导入utils、model、common、api工程，方法同parent工和的导入。

![1568881269669](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/12.png)

工程结果如下：

​	![1568821004271](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/13.png)

# 安装MongoDB

### 下载mongodb

下载3.4版本：http://downloads.mongodb.org/win32/mongodb-win32-x86_64-2008plus-ssl-v3.4-
latest-signed.msi

### 安装mongodb

![1568881417580](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/14.png)

​					路径自己选择一下

### 配置mongodb

创建几个文件夹具体如下：数据库路径（data目录）、日志路径（logs目录）和配置文件（mongo.conf文件）

![1568881493498](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/15.png)

创建配置文件mongo.conf，文件内容如下：

```
#数据库路径
dbpath=X:\development\java\mongoDB\data
#日志输出文件路径
logpath=X:\development\java\mongoDB\logs\mongo.log
#错误日志采用追加模式
logappend=true
#启用日志文件，默认启用
journal=true
#这个选项可以过滤掉一些无用的日志信息，若需要调试使用请设置为false
quiet=true
#端口号 默认为27017
port=27017
```

### 安装 MongoDB服务 

在mongo的bin目录下执行此命令!!! :

安装的时候cmd一定要启用管理员的模式!!!

```
mongod.exe --config "X:\development\java\mongoDB\mongo.conf" --install
```

### 启动MongoDB服务

```
net start MongoDB
```

### 关闭MongoDB服务

```
net stop MongoDB
```

### 移除MongoDB服务

移除的时候cmd一定要启用管理员的模式!!!

```
"X:\development\java\mongoDB\bin\mongod.exe" --remove
```

### 测试

启动mongodb服务， 
命令执行后，浏览器中输入http://127.0.0.1:27017看到如下界面即说明启动成功

![1568882724838](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/16.png)

# MongoDB客户端

### 命令行

通过bin目录下的mongo.exe连接mongodb

![1568882777070](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/17.png)

### studio3t

studio3t是mongodb优秀的客户端工具。官方地址在https://studio3t.com/

- 下载studio3t   https://studio3t.com/download/

- 安装并启动

- 创建一个新连接：

  ![](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/18.png)

  ![1568883276097](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/19.png)

  ​	![1568883291175](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/20.png)

- 连接成功

![1568883320166](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/21.png)

- 修改字体： 
  默认Studio3t的字体太小，需要修改字体： 点击菜单：Edit--->Preferences

  ![1568883411980](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/22.png)

# mongodb入门

### 基础概念

在mongodb中是通过数据库、集合、文档的方式来管理数据，下边是mongodb与关系数据库的一些概念对比：

| SQL术语/概念 | MongoDB术语/概念 | 解释/说明                                 |
| ------------ | ---------------- | ----------------------------------------- |
| database     | database         | 数据库                                    |
| table        | collection       | 数据库表/集合                             |
| row          | document         | 数据记录行/文档                           |
| column       | ﬁeld             | 数据字段/域                               |
| index        | index            | 索引                                      |
| table joins  |                  | 表连接（MongoDB不支持）                   |
| primary key  | primary key      | 主键,MongoDB自动在每个集合中添加_id的主键 |

![1568883625110](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/23.png)

1、一个mongodb实例可以创建多个数据库 
2、一个数据库可以创建多个集合 
3、一个集合可以包括多个文档

### 连接mongodb

mongodb的使用方式是客户服务器模式，即使用一个客户端连接mongodb数据库（服务端）。 

#### 1.命令

```
mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][? options]]
```

```
mongodb:// 固定前缀
username：账号，可不填 
password：密码，可不填 
host：主机名或ip地址，只有host主机名为必填项。 port：端口，可不填，默认27017 
/database：连接某一个数据库 
?options：连接参数，key/value对
```

```
例子：
mongodb://localhost 连接本地数据库27017端口
mongodb://root:itcast@localhost 使用用户名root密码为itcast连接本地数据库27017端口 
mongodb://localhost,localhost:27018,localhost:27019，连接三台主从服务器，端口为27017、27018、27019
```

#### 2.javascript shell

windows版本的mongodb安装成功，在安装目录下的bin目录有mongo.exe客户端程序

![1568897438801](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/24.png)

cmd状态执行mongo.exe：

![1568897453209](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/25.png)

此时就可以输入命令来操作mongodb数据库了，javascript shell可以运行javascript程序。

#### 3.studio3T

#### 4.java程序

##### 4.1导入pom依赖

```
<dependency>
    <groupId>org.mongodb</groupId>     
    <artifactId>mongo‐java‐driver</artifactId>     <version>3.4.3</version>
</dependency>
```

##### 4.2创建mongodb 客户端测试

```
@Test
public void testConnection(){
    //创建mongodb 客户端
    MongoClient mongoClient = new MongoClient( "localhost" , 27017 );     
    //或者采用连接字符串
 //MongoClientURI connectionString = new MongoClientURI("mongodb://root:root@localhost:27017");
 //MongoClient mongoClient = new MongoClient(connectionString);     
 //连接数据库
 MongoDatabase database = mongoClient.getDatabase("test");
    // 连接collection
    MongoCollection<Document> collection = database.getCollection("student");     //查询第一个文档
    Document myDoc = collection.find().first();
    //得到文件内容 json串
    String json = myDoc.toJson();
    System.out.println(json);
}
```

### 使用mongoDB数据库

#### 1.查询数据库

```
show dbs 查询全部数据库 
db 显示当前数据库 
```

#### 2.创建数据库

```
use DATABASE_NAME

例子：
use test02 
有test02数据库则切换到此数据库，没有则创建
注意： 
新创建的数据库不显示，需要至少包括一个集合
```

#### 3.删除数据库（慎用！！！）

```
db.dropDatabase()

例子：
删除test02数据库 
先切换数据库：use test02 
再执行删除：db.dropDatabase()
```

### 集合

集合相当于关系数据库中的表，一个数据库可以创建多个集合，一个集合是将相同类型的文档管理起来。

#### 1.创建集合

```
db.createCollection(name, options) 
name: 新创建的集合名称
options: 创建参数,可以省略
```

#### 2.删除集合

```
db.collection.drop()
例子：
db.student.drop() 删除student集合
```

### 文档

mongodb中文档的格式是json格式，下边就是一个文档，包括两个key：_id主键和name

```
{
    "_id" : ObjectId("5b2cc4bfa6a44812707739b5"),     
    "name" : "黑马程序员"
}
```

#### 1.插入文档

命令：

```
db.COLLECTION_NAME.insert(document)
```

每个文档默认以_id作为主键，主键默认类型为ObjectId（对象类型），mongodb会自动生成主键值。

例子：

```
db.student.insert({"name":"黑马程序员","age":10})
```

注意：同一个集合中的文档的key可以不相同！但是建议设置为相同的。

#### 2.更新文档

命令：

```
db.collection.update( 
   <query>, 
   <update>, 
   <options>
)
query:查询条件，相当于sql语句的where update：更新文档内容
options：选项
```

##### 1.替换文档

将符合条件 "name":"北京黑马程序"的第一个文档替换为{"name":"北京黑马程序员","age":10}。

```
db.student.update({"name":"黑马程序员"},{"name":"北京黑马程序员","age":10})
```

#####  2、$set修改器 

使用$set修改器指定要更新的key，key不存在则创建，存在则更新。 将符合条件 "name":"北京黑马程序"的所有文档更新name和age的值。

```
db.student.update({"name":"黑马程序员"},{$set:{"name":"北京黑马程序员","age":10}},{multi:true})
```

multi：false表示更新第一个匹配的文档，true表示更新所有匹配的文档。

#### 3.删除文档

命令:

```
db.student.remove(<query>) 
query：删除条件，相当于sql语句中的where
```

##### 1.删除所有文档

```
db.student.remove({})
```

##### 2.删除符合条件的文档

```
db.student.remove({"name":"黑马程序员"})
```

#### 4.查询文档

命令:

```
db.collection.find(query, projection) 
query：查询条件，可不填 
projection：投影查询key，可不填
```

##### 1.查询全部

```
db.student.find()
```

##### 2.查询符合条件的记录 

查询name等为"黑马程序员"的文档。

```
db.student.find({"name":"黑马程序员"})
```

##### 3.投影查询 

只显示name和age两个key，_id主键不显示。

```
db.student.find({"name":"黑马程序员"},{name:1,age:1,_id:0})
```

### 用户

#### 1.创建用户

```
mongo>db.createUser(
{ user: "<name>",
  pwd: "<cleartext password>",
  customData: { <any information> },
  roles: [
    { role: "<role>", db: "<database>" } | "<role>",     ...
  ]}
)
```

例子： 
创建root用户，角色为root

```
use admin
db.createUser(
     {
       user:"root",
       pwd:"root", 
       roles:[{role:"root",db:"admin"}]      
     }
  )
```

内置角色如下：
1. 数据库用户角色：read、readWrite;
2. 数据库管理角色：dbAdmin、dbOwner、userAdmin；

3. 集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManager；
4. 备份恢复角色：backup、restore；
5. 所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、
dbAdminAnyDatabase 
6. 超级用户角色：root

#### 2.查询用户

查询当前库下的所有用户：

```
show users
```

#### 3.删除用户

语法格式： 

```
db.dropUser("用户名")
```

例子：
删除root1用户

```
db.dropUser("root1")
```

#### 4.修改用户

语法格式：

```
db.updateUser(
  "<username>",
  {
    customData : { <any information> },
    roles : [
              { role: "<role>", db: "<database>" } | "<role>",               ...
            ],
    pwd: "<cleartext password>"
    },
    writeConcern: { <write concern> })
```

例子： 修改root用户的角色为readWriteAnyDatabase

```
use admin 
db.updateUser("root",{roles:[{role:"readWriteAnyDatabase",db:"admin"}]})
```

#### 5.修改密码

语法格式：

```
db.changeUserPassword("username","newPasswd")
```

例子： 
修改root用户的密码为123

```
use admin
db.changeUserPassword("root","123")
```

# 导入CMS数据库

导入cms数据库：
使用Studio 3T软件导入cms数据库 

### 1.创建xc_cms数据库

![1568948090355](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/26.png)

### 2.导入 cms数据库 
右键数据库，点击导入数据库

![1568948106143](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/27.png)

打开窗口，选择第一个 json。 
下一步，选择要导入的数据文件（json文件）

![1568948123892](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/28.png)

下一步操作即可完成。 

导入成功：

![1568948145036](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/29.png)

# 页面查询接口定义

### 需求分析

在梳理完用户需求后就要去定义前后端的接口，接口定义后前端和后端就可以依据接口去开发功能了。 
本次定义页面查询接口，本接口供前端请求查询页面列表，支持分页及自定义条件查询方式。
具体需求如下：
1、分页查询CmsPage 集合下的数据
2、根据站点Id、模板Id、页面别名查询页面信息
3、接口基于Http Get请求，响应Json数据

站点Id :  就是每个网站的首页都有门户主站    课程预览站点     课程详情站点  等等

cms_page表中的siteId就是cms_site中的_id

模板Id : 页面的布局  例如cms_page表中的课程详情页它们的templateId都是相同的

cms_page表中的templateId就是cms_template中的_id

### 模型类介绍

接口的定义离不开数据模型，根据前边对需求的分析，整个页面管理模块的数据模型如下：

![1568948746401](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/30.png)

在xc-framework-model工程下com.xuecheng.framework.domain.cms包中定义这些模型类

CmsSite：站点模型 

CmsTemplate：页面模板 

CmsPage：页面信息 

#### 简单介绍CmsPage类

```
@Data
@ToString
@Document(collection = "cms_page")
public class CmsPage {
    /**
     * 页面名称、别名、访问地址、类型（静态/动态）、页面模版、状态
     */
    //站点ID
    private String siteId;
    //页面ID
    @Id
    private String pageId;
    //页面名称
    private String pageName;
    //别名
    private String pageAliase;
    //访问地址
    private String pageWebPath;
    //参数
    private String pageParameter;
    //物理路径
    private String pagePhysicalPath;
    //类型（静态/动态）
    private String pageType;
    //页面模版
    private String pageTemplate;
    //页面静态化内容
    private String pageHtml;
    //状态
    private String pageStatus;
    //创建时间
    private Date pageCreateTime;
    //模版id
    private String templateId;
    //参数列表
    private List<CmsPageParam> pageParams;
    //模版文件Id
    //private String templateFileId;
    //静态文件Id
    private String htmlFileId;
    //数据Url
    private String dataUrl;

}
```

#### 属性说明：
1、定义一个页面需要指定页面所属站点 
一个站点包括多个页面，比如：学成在线的门户站点（网站）包括了多个页面。 
2、定义一个页面需要指定页面使用的模板 
多个页面可以使用相同的模板，比如：商品信息模板，每个商品就是一个页面，所有商品使用同一个商品信息模板 注解说明：
@Data、@ToString、@Document注解表示什么意思？ 
@Data、@ToString：是Lombok提供的注解，下面会介绍。
@Document：是Spring Data mongodb提供的注解，最终CMS的开发会使用Mongodb数据库。

##### Lombok插件

上边的Data注解表示什么意思呢？Data注解，ToString注解都是Lombok提供的注解。 
Lombok是一个实用的java工具，使用它可以消除java代码的臃肿，Lombok提供一系列的注解，使用这些注解可 
以不用定义getter/setter、equals、构造方法等，它会在编译时在字节码文件自动生成这些通用的方法，简化开发 人员的工作。

项目官方地址：https://www.projectlombok.org/ 
比如上节创建的UserTest模型，@Data注解可以自动生成getter/setter方法，@ToString生成tostring方法。 

###### 使用方法：

1、在项目中添加Lombok的依赖
作用：项目在编译时根据Lombok注解生成通用方法。

```
<dependency>     
	<groupId>org.projectlombok</groupId>     
	<artifactId>lombok</artifactId> 
</dependency>
```

2、在IDEA开发工具中添加Lombok插件 
作用：使用IDEA开发时根据Lombok注解生成通用方法，不报错。

![1568949937927](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/31.png)

![1568949959312](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/32.png)

### 定义请求及响应类型

在xc-framework-model工程中com.xuecheng.framework.domain.cms.request包下定义QueryPageRequest类

1、定义请求模型类QueryPageRequest，此模型作为查询条件类型 
	  为后期扩展需求，请求类型统一继承RequestData类型

2、响应结果类型，分页查询统一使用QueryResponseResult

```
@Data
public class QueryPageRequest {
    //接收页面查询的查询条件
    //站点id
    //站点id
    @ApiModelProperty("站点id")
    private String siteId;
    //页面ID
    private String pageId;
    //页面名称
    private String pageName;
    //别名
    private String pageAliase;
    //模版id
    private String templateId;
}
```

### 定义接口

在xc-service-api接口工程中定义接口CmsPageControllerApi，在xc-service-api工程单独定义接口的原因如下： 

1、接口集中管理
2、Api工程的接口将作为各微服务远程调用使用。 
页面查询接口定义如下：

在xc-service-api接口工程的com.xuecheng.api.cms包下定义接口:

```
public interface CmsPageControllerApi {

    public QueryResponseResult findList(int page, int size, QueryPageRequest queryPageRequest) ;

}
```

此接口编写后会在CMS服务工程编写Controller类实现此接口。

# 页面查询服务端开发

### 创建CMS服务工程

#### 创建maven工程
CMS工程的名称为 xc-service-manage-cms，父工程为xc-framework-parent。 

##### 1.导入pom.xml

pom.xml如下：

```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <artifactId>xc-framework-parent</artifactId>
        <groupId>com.xuecheng</groupId>
        <version>1.0-SNAPSHOT</version>
        <relativePath>../xc-framework-parent/pom.xml</relativePath>
    </parent>
    <modelVersion>4.0.0</modelVersion>

    <artifactId>xc-service-manage-cms</artifactId>
    <dependencies>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xc-service-api</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xc-framework-model</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xc-framework-utils</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <dependency>
            <groupId>com.xuecheng</groupId>
            <artifactId>xc-framework-common</artifactId>
            <version>1.0-SNAPSHOT</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-freemarker</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-mongodb</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-amqp</artifactId>
        </dependency>
        <dependency>
            <groupId>com.squareup.okhttp3</groupId>
            <artifactId>okhttp</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
        </dependency>
    </dependencies>

</project>
```

由于cms工程要连接mongodb所以需要在在cms服务端工程添加如下依赖： 项目使用spring data mongodb操作mongodb数据库

```
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-mongodb</artifactId>
</dependency>
```

##### 2.创建工程结构

com.xuecheng.manage_cms.conﬁg：配置类目录，数据库配置、MQ配置等 com.xuecheng.manage_cms.dao：dao接口目录 
com.xuecheng.manage_cms.service：service类目录 com.xuecheng.manage_cms.web.controller：controller类目录 
工程结构如下：

![1568966988214](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/33.png)

##### 3.配置文件

在classpath下配置application.yml

```
server:
  port: 31001
spring:
  application:
    name: xc‐service‐manage‐cms
  data:
    mongodb:
      uri:  mongodb://root:123@localhost:27017       database: xc_cms
```

拷贝logback-spring.xml，此文件为工程的日志配置文件。(记得修改日志输出路径)

##### 4.SpringBoot 启动类

Spring Boot应用需要创建一个应用启动类，启动过程中会扫描Bean并注入spring 容器 注意：此类创建在本工程com.xuecheng.manage_cms包下 :

```
@SpringBootApplication
@EntityScan("com.xuecheng.framework.domain.cms")//扫描实体类
@ComponentScan(basePackages={"com.xuecheng.api"})//扫描接口
@ComponentScan(basePackages={"com.xuecheng.manage_cms"})//扫描本项目下的所有类
public class ManageCmsApplication {
    public static void main(String[] args) {
        SpringApplication.run(ManageCmsApplication.class,args);
    }
}
```

#### 测试Controller

使用springMVC完成接口实现开发，这里暂时使用测试数据，稍后会让controller调用service来查询数据。

#### 接口开发规范

##### 1.Api请求及响应规范

为了严格按照接口进行开发，提高效率，对请求及响应格式进行规范化。
1、get 请求时，采用key/value格式请求，SpringMVC可采用基本类型的变量接收，也可以采用对象接收。 

2、Post请求时，可以提交form表单数据（application/x-www-form-urlencoded）和Json数据（ContentType=application/json），文件等多部件类型（multipart/form-data）三种数据格式，SpringMVC接收Json数据 使用@RequestBody注解解析请求的json数据。 
4、响应结果统一信息为：是否成功、操作代码、提示信息及自定义数据。
5、响应结果统一格式为json。

##### 2.Api定义约束

Api定义使用SpringMVC来完成，由于此接口后期将作为微服务远程调用使用，在定义接口时有如下限制： 

1、@PathVariable 统一指定参数名称，如：@PathVariable("id") 

2、@RequestParam统一指定参数名称，如： @RequestParam（"id"）

#### 页面查询接口测试

上边的代码是基于服务端编写接口，如果前端人员等待服务端人员将接口开发完毕再去开发前端内容这样做效率是 非常低下的，所以当接口定义完成，可以使用工具生成接口文档，前端人员查看接口文档即可进行前端开发，这样 前端和服务人员并行开发，大大提高了生产效率。
本章节介绍两种接口开发工具，Swagger和Postman。

##### Swagger:

###### 1.Swagger介绍

OpenAPI规范（OpenAPI Speciﬁcation 简称OAS）是Linux基金会的一个项目，试图通过定义一种用来描述API格 式或API定义的语言，来规范RESTful服务开发过程，目前版本是V3.0，并且已经发布并开源在github上。
（https://github.com/OAI/OpenAPI-Speciﬁcation） 
Swagger是全球最大的OpenAPI规范（OAS）API开发工具框架，支持从设计和文档到测试和部署的整个API生命周 期的开发。 (https://swagger.io/)
 Spring Boot 可以集成Swagger，生成Swagger接口，Spring Boot是Java领域的神器，它是Spring项目下快速构建 项目的框架。

###### 2.Swagger常用注解

在Java类中添加Swagger的注解即可生成Swagger接口，常用Swagger注解如下： 
@Api：修饰整个类，描述Controller的作用 
@ApiOperation：描述一个类的一个方法，或者说一个接口 
@ApiParam：单个参数描述 
@ApiModel：用对象来接收参数 
@ApiModelProperty：用对象接收参数时，描述对 象的一个字段 
@ApiResponse：HTTP响应其中1个描述 
@ApiResponses：HTTP响应整体描述 
@ApiIgnore：使用 该注解忽略这个API 
@ApiError ：发生错误返回的信息 
@ApiImplicitParam：一个请求参数 
@ApiImplicitParams：多个请求参数



@ApiImplicitParam属性：

| 属性         | 取值   | 作用                                          |
| :----------- | ------ | --------------------------------------------- |
| paramType    |        | 查询参数类型                                  |
|              | path   | 以地址的形式提交数据                          |
|              | query  | 直接跟参数完成自动映射赋值                    |
|              | body   | 以流的形式提交 仅支持POST                     |
|              | header | 参数在request headers 里边提交                |
|              | form   | 以form表单的形式提交 仅支持POST               |
| dataType     |        | 参数的数据类型 只作为标志说明，并没有实际验证 |
|              | Long   |                                               |
|              | String |                                               |
| name         |        | 接收参数名                                    |
| value        |        | 接收参数的意义描述                            |
| required     |        | 参数是否必填                                  |
|              | true   | 必填                                          |
|              | false  | 非必填                                        |
| defaultValue |        | 默认值                                        |

###### 3.Swagger接口定义

修改接口工程中页面查询接口，添加Swagger注解。

```
@Api(value="cms页面管理接口",description = "cms页面管理接口，提供页面的增、删、改、查")
public interface CmsPageControllerApi {
    //页面查询
    @ApiOperation("分页查询页面列表")
    @ApiImplicitParams({
            @ApiImplicitParam(name="page",value = "页码",required=true,paramType="path",dataType="int"),
            @ApiImplicitParam(name="size",value = "每页记录数",required=true,paramType="path",dataType="int")
    })
    public QueryResponseResult findList(int page, int size, QueryPageRequest queryPageRequest);
}
```

在QueryPageRequest类中使用注解 ApiModelProperty 对属性注释：

```
@Data
public class QueryPageRequest extends RequestData {
    //接收页面查询的查询条件
    //站点id
    //站点id
    @ApiModelProperty("站点id")
    private String siteId;
    //页面ID
    @ApiModelProperty("页面ID")
    private String pageId;
    //页面名称
    @ApiModelProperty("页面名称")
    private String pageName;
    //别名
    @ApiModelProperty("页面别名")
    private String pageAliase;
    //模版id
    @ApiModelProperty("模版id")
    private String templateId;
}
```

###### 4.Swagger接口测试

Swagger接口生成工作原理：
1、系统启动，扫描到api工程中的Swagger2Conﬁguration类 
2、在此类中指定了包路径com.xuecheng，找到在此包下及子包下标记有@RestController注解的controller类 
3、根据controller类中的Swagger注解生成接口文档。

启动cms服务工程，查看接口文档，请求：http://localhost:31001/swagger-ui.html

![1569058635458](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/34.png)

点击“分页查询页面列表”，打开接口详情

![1569058646763](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/35.png)

使用Swagger工具测试服务接口：
1）在cms服务接口中打断点 
2）打开接口文档页面，输入请求参数，点击“Try it out”发起请求。

![1569058661692](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/36.png)

##### Postman

Postman是一款功能强大的http接口测试工具，使用postman可以完成http各种请求的功能测试。 
官方地址：https://www.getpostman.com/
###### 1.安装Postman
本教程使用，双击打开 Postman-win64-6.0.10-Setup.exe
新建一个Postman窗口

![1569058705716](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/37.png)

![1569058712093](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/38.png)

###### 2.使用postman测试http接口

![1569058739619](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/39.png)

###### 3.请求参数设置

1） get请求参数设置

![1569058768718](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/40.png)

2）post请求参数设置

![1569058777925](https://blog-mamba.oss-cn-beijing.aliyuncs.com/java/items/xczx/xczx01/41.png)

form-data：将表单的数据转为键值对，并且可以包括文件
x-www-form-urlencoded: content-type为application/x-www-from-urlencoded，将表单的数据转为键值对 
raw：请求text、json、xml、html，比如如果请求json数据则使用此格式 
binary：content-type为application/octet-stream，可用于上传文件。