---
title: 逆向分析(二)----硬编码寻找序列号
top: 1110
tags: []
date: 2019-03-09 23:11:21
permalink:
categories: windows逆向
image:


---

<p class="description"></p>
<meta name="referrer" content="no-referrer" />
<img src="http://blog-mamba.oss-cn-beijing.aliyuncs.com/springboot/title.png">

<!-- more -->

### 逆向分析(二)----硬编码寻找序列号

- 硬编码寻找序列号(一)

  - 首先要会用这个软件
  - 导入OD

  ![1566962956072](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566962956072.png)

  - 使用智能搜索
  - 一般英文的话ASCII居多
  - 中文或者韩文UNICEODE居多
  - 如果不知道的话就用智能搜索

  ![1566963103038](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566963103038.png)

  ![1566963242050](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566963242050.png)

  在MessageBoxA函数和GetDlgItemTextA函数都打上断点

  运行这个程序,此时就在GetDlgItemTextA获取文本框的内容的时候断下来了

  ![1566963385148](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566963385148.png)

  ![1566963586493](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566963586493.png)

  找到Buffer参数   buffer参数指的是你在编辑框中输入的值所存放的地方

  ![1566963664992](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566963664992.png)

  在数据窗口中去跟随个值

  ![1566967316368](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566967316368.png)

  然后在调试中使用执行到返回,就是将这个GetDlgItemTextA这个函数执行到return的地方

  ![1566967605679](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566967605679.png)

  拿到了我编辑框中的值

  ![1566967906929](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566967906929.png)

  此时将403010地址的数值存放到这个ebx中存放的是四个1

  ![1566968257043](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566968257043.png)

  然后将地址00403008里面的数据和ebx里面的数据进行一个比较

  ![1566968762987](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566968762987.png)

  此时Z标志位不是1  也就说明ebx的值和[403008]的值不同    然后je就不发生跳转一直往下走  

  然后就弹窗注册码不正确

  ![1566969402944](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566969402944.png)

  这样的话注册码就正确

  ![1566969471459](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566969471459.png)

  其实还可以根据字符串直接分析这里,但是不推荐为什么呢?

  防止作者故意埋下陷阱以致中招





- 硬编码寻找序列号(二)
  - ctrl+n   查看函数列表
  - 找到GetDlgItemTextA函数
  - 在此函数上设置切换断点
  - F9运行
  - 输入6个1   点击验证
  
  ![1567149028313](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567149028313.png)
  
  - 在堆栈数据窗口中找到GetDlgItemTextA函数的参数Buffer,然后在数据窗口中跟随
  
  ![1567151041784](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567151041784.png)
  
  - 在数据窗口中跟随的数据是数值列的一个数据0040300C
  - 如果不想在堆栈窗口中进行跟随的话,也可以在HEX数据窗口中右键---->转到0040300C
  - 然后我们在上面的调试窗口中,选择执行到返回ctrl+f9,将这个GetDlgItemTextA函数执行完毕
  - 然后我们F8再运行一步,就出call了
  
  ![1567149198191](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567149198191.png)
  
  - mov  ebx,dword ptr ds:[0x40300C]
  - 将地址40300C交给ebx   只取40300C地址上的前四个字节
  - mov  edx,dword ptr ds:[0x40204B]
  - 将地址0x40204B交给edx   只取0x40204B地址上的前四个字节
  - 继续向下运行
  
  ![1567151377810](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567151377810.png)
  
  - 发现edx的值是31323334
  - cmp  ebx和edx比较的是机器码不是十进制的数字
  
  ![1567151590858](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567151590858.png)
  
  - 标志位Z为0  那么就不发生跳转
  - 然后我们就能测试出来edx为真码  为1234



- 硬编码寻找序列号(三)

  - ctrl+n
  - 直接输入GetWindowTextA
  - GetWindowTextA和GetDlgItemTextA都是获取编辑框文本的
  - 在GetWindowTextA上切换断点

  ![1567170369816](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567170369816.png)

  - 在MessageBoxA上切换断点
  - 在lstrcmpA上也来个切换断点
  - 这次在CPU窗口使用智能中文搜索

  ![1567171591308](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567171591308.png)

  - 双击  抱歉,序列号错误了,请核对后重新输入

  ![1567171740756](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567171740756.png)

  ![1567172169037](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567172169037.png)

  - 在这个关键跳这里打上断点
  - 将程序运行起来
  - 输入111111作为序列号,点击验证

  ![1567172370622](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567172370622.png)

  - call上面这两个push的值为参数
  - 右键查看立即数就可以看到这两个参数的值

  ![1567172497262](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567172497262.png)

  - 走完call  eax的值为FFFFFFFF
  - jnz   0标志位   z为0,发生跳转,z为1,不发生跳转
  - 然后z标志位为0就发生跳转
  - 大写字母和小写字母的机器码不一样





- 硬编码寻找序列号(四)
  - ctrl+n
  - 找到GetDlgItemTextA打上切换断点
  - 在编辑框中输入11111111
  - 在GetDlgItemTextA断首的位置断下来了
  - 然后在GetDlgItemTextA参数Buffer点击右键在数据窗口中跟随

  ![1567177677083](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567177677083.png)

  ![1567177972763](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1567177972763.png)

  这里得到我输入的8个1

  - F8下一步进入程序领空