### 基础分析

![1566567989890](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566567989890.png)

![1566568242777](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566568242777.png)

- loadIconA

  调用了一个加载图标的函数  

  loadIconA外部函数不是本模块中的函数    &取地址符  USER32  windows的函数库

  的loadIconA函数



- dll

  windows的动态链接库,提供给exe程序(可执行文件)使用的函数库

  exe  bat  com 都是可执行文件

  如果说不调用windws的dll的话把库函数都集成在本身的文件内部,那么这个可执行程序所占用的硬盘空间就会非常大.



- 系统领空

  ![1566620146143](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566620146143.png)

  从这里通过call  跟随进去  然后一直追溯到user32

  ![1566623713455](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566623713455.png)

  如何回到可执行文件的模块了,摁小键盘的减号键

  不要随便改系统领空



- messageboxA

  - ![1566625339665](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566625339665.png)
  - 调用了弹框函数,跟随进去找到段首

  ![1566624857499](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566624857499.png)

  - 或者使用command

  ![1566625144688](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566625144688.png)

  - ctrl+g  goto 快捷键   注意大小写命令一定要对

  ![1566625398550](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566625398550.png)



- ctrl+n

  - 必须在当前程序下使用快捷键ctrl+n
  - 在系统领空下使用ctrl+n的话就会跳到系统领空对应的dll中  (不要这样做)
  - 查看本程序所调用的api

  ![1566629646149](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566629646149.png)

  直接在这个窗口中去搜索你需要的函数名   标题上的名称也会随之改变

  ![1566629716621](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566629716621.png)

  找到你想要的函数之后在这里右键,选中反汇编窗口中跟随输入函数

  然后就可以跳到MessageBoxA函数中

  

- 设置断点

  - 然后在MessageBoxA函数的段首下上一个断点 (双击或者F2)
  - 或者在command中使用命令bp MessageBoxA

  ![1566630287328](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566630287328.png)

  - 点击按钮B就可以进到断点窗口

  ![1566630397217](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566630397217.png)



- 调试程序

  - 先在MessageBoxA函数的段首打上断点
  - 然后摁F9将程序运行起来    将程序运行起来断到断点处

  ![1566631584431](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566631584431.png)

  - 断到断点处  堆栈框会有相应的信息

  ![1566632020971](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566632020971.png)

  执行完以后跳到004013C1地址处

  ![1566659216451](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566659216451.png)

  顺着这个框往上找,找到条件跳转的地方

  ![1566633913596](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566633913596.png)
  
  在跳转的地方打上断点,这个跳转是第一次跳转
  
  ![1566660476013](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566660476013.png)
  
  ![1566660598224](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566660598224.png)
  
  ![1566660754164](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566660754164.png)
  
  ![1566660861309](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566660861309.png)
  
  找到段首的位置,点击转到call来自的地址,第二次调用的地方是
  
  77D507EA是messageboxa函数的首地址
  
  0040138B是第一次跳转要弹框的地址
  
  00401245是第二次跳转要弹框的地址
  
  ![1566696238993](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566696238993.png)
  
  找到第一次的弹框处  将cmp   je   nop掉
  
  第一个弹框就被干掉了
  
  ![1566696401837](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566696401837.png)
  
  在调用第二次弹窗之前也打上断点将je  改为jmp进行强跳
  
  ![1566696499983](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566696499983.png)
  
  破解成功!!!
  
  ![1566696549095](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566696549095.png)

​		回到主界面选择所有修改,之后选择全部复制

​			![1566696621038](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566696621038.png)

​	选择保存文件



​	第二种分析方式通过使用智能搜索来达到目的:

​	![1566696935806](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566696935806.png)

![1566697678416](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566697678416.png)

![1566697805100](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566697805100.png)

通过段首来找到调用它的地方

![1566697849271](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566697849271.png)

将je改为jmp进行强跳

再找别的地方的字符串

![1566698208776](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566698208776.png)

找到跳转处进行nop



- CC断点

  - F2断点
  - 普通断点
  - int3断点

  ![1566699895249](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566699895249.png)

  CPU看到这个CC就会出现异常,然后OD就会捕获异常将这个异常给断下来

  CC是int3指令的机器码

  jmp对应EB

  OD为了方便我们查看所以不显示CC01 而现实原始机器码74 01

  

  command:

  bp设置普通断点后面不仅可以跟api  还可以跟地址  例如:bp 40101A

  使用 bpx messageboxA 然后跳到B窗口 将所有的messageboxA全部都设置上断点

  bp断点设置的是系统领空 函数的段首 第一行设置的断点

  bpx设置的断点是在程序领空  调用的地方设置CC断点  把所有程序领空涉及到这个api的地方都打上了断点

  CC断点:

  ​			 优点可以打无数个

  ​			  缺点很容易被检测到

  简单的绕过检测,比如在系统领空的messageboxA里面第一行下了CC断点但是被检测到了可以在下一行或者附近下断点



- 内存断点

  ![1566702303861](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566702303861.png)

  ![1566702439661](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566702439661.png)

  ![1566703106769](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566703106769.png)

  在hex数据窗口中使用ctrl+g

  ![1566703530695](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566703530695.png)

  这样这个地址无论是访问还是写入都会断下来

  内存断点:

  ​		优点:绕过普通检测,分清楚是执行还是写入

  ​		缺点:只能设置一个,在B窗口查不到内存断点,只能自己记录

  删除断点只能重新设置一个断点或者删除当前断点

  原理:设置内存写入,就是让这个地址不可写入,假如说我们非要写入那么就会触发一个异常然后OD会捕获这个异常,从而将程序断下来.



- 区段内存断点
  - 摁下alt+m  跳入程序领空
  - 找到code或text代码段  设置内存访问断点    断点返回401000~402000
  - 回到反汇编窗口
  - F9启动程序,每运行一次都会断下来

  ![1566715386443](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566715386443.png)
  
  
  
  - 找到kernel32的text
  - 设置内存访问断点(上一个断点会失去作用)
  - 回到C窗口
  - 我们在执行kernel32.GetModuleHandleA函数的时候就会断下来
  
  ![1566715756440](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566715756440.png)
  
  - 如何快速从系统领空回到程序领空呢?
  
  - 1.在堆栈窗口 右键在反汇编窗口中跟随快速返回程序领空
  - 2.删除内存断点,在调试窗口找到执行用户代码



- 硬件断点

  - 只能设置四个硬件断点
  - 在调试窗口点击硬件断点可观测硬件断点

  ![1566715805001](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566715805001.png)

  

  

  - 如何使用硬件断点呢?

    - 找到你要下断的反汇编指令的位置右键断点-->硬件执行     或硬件写入               或硬件访问
    - 在command命令中使用命令HE 0040101A  也可以设置上硬件断点
    - 我们可以在上图的窗口查看硬件断点和删除硬件断点
    - 设置一字节写入断点

    1.先跟随到这个内存地址

    ![1566717166974](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566717166974.png)

    2.写入一个字节的硬件断点

    ![1566717229921](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566717229921.png)

  - 在所有对4020CA内存写入的地方都下了一个内存断点

  - 硬件断点和内存断点都是没有CC的

  - 硬件断点检测内存的特征可读  可写  可执行也是没用的

  - 内存断点重载的话会被清空,但是硬件断点不会被清空

  - 硬件断点停止的地方是你设置硬件断点的下一行,所以我们要看停下来的上一行指令



- 条件断点
  - 其实就是一个CC断点
  - shift+F2
- 条件记录断点
  - ctrl+g  MessageBoxA
  
  - 来到user32模块
  
  - 选中第一行右键断点条件记录 或者 shift+f4
  
  - 表达式填入[ESP]
  
  - 暂停程序  从不
  
  - 记录表达式数值  永远
  
  - 记录函数参数    永远
  
  - 点击上方L按钮进入日志窗口
  
  - 右键清除窗口
  
  - 右键记录到文件将日志全部导出
  
  - 双击B窗口的断点就可以跳转到断点处
  
  - 回到日志窗口,F9运行程序,日志就打印出来了
  
  - 日志里面会出现调用完 call以后返回的地址
  
    ![1566788093355](C:\Users\85896\AppData\Roaming\Typora\typora-user-images\1566788093355.png)
  
  - 假如MessageBoxA
  
  - 选中第一行右键断点条件记录 或者 shift+f4
  
  - 